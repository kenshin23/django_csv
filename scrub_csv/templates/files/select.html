<h1>Select header fields for {{ document }}</h1>

{% if not error_message %}
    <form action="{% url 'files:process' document.id %}" method="post">
    {% csrf_token %}
    <p>Showing you the first {{ line_count }} line</p>
    <p>Now, please select one of the following for each column:</p>
    <ul>
    {% if existing_keys_list %}
        <li>An existing field from the database</li>
    {% endif %}
        <li>Use the file's header, if available (if not, the column will be ignored)</li>
        <li>A custom field name</li>
        <li>Ignore this column (do not import it to the database)</li>
    </ul>

    <table>
        <thead>
            <tr>
            {% for column in content.0 %}
                <th>Column #{{ forloop.counter }}</th>
            {% endfor %}
            </tr>
            <tr>
            {% for column in content.0 %}
                <td>
                {% if existing_keys_list %}
                    <input type="radio" name="choice{{ forloop.counter }}" value="select"> Existing field<br/>
                    <select name="key{{ forloop.counter}}">
                        <option value="">Select a field</option>
                    {% for key in existing_keys_list %}
                        <option value="{{ key }}">{{ key }}</option>
                    {% endfor %}
                    </select>
                {% endif %}
                    <input type="radio" name="choice{{ forloop.counter }}" value="header"> Use header<br/>
                    <input type="radio" name="choice{{ forloop.counter }}" value="custom"> Enter custom name<br/>
                    <input type="text" name="custom{{ forloop.counter }}" value=""><br/>
                    <input type="radio" name="choice{{ forloop.counter }}" value="ignore"> Ignore column
                </td>
            {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% for row in content %}
            <tr class="row-item{% if forloop.first %} row-first{% endif %}">
            {% for item in row %}
                <td>{{ item }}</td>
            {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <p>
        Upon analysis, the first row of the file {% if has_header %}appears{% else %}does not appear{% endif %} to be a header row. (This could be wrong, though.)<br/>
        Please confirm below:</p>
    </p>
    <p>
        <label for="has_header_row">
            <input type="checkbox" name="has_header_row" id="has_header_row" value="1" {% if has_header %}checked="checked"{%endif %}>
            The file does have a header row
        </label> <span>(Check/uncheck as needed)</span>
    </p>
    <input type="submit" value="Select headers" />
    </form>
{% else %}
    <p><strong>{{ error_message }}</strong></p>
{% endif %}
<p><a href="{% url 'files:detail' document.id %}">Go back to file details page.</a></p>